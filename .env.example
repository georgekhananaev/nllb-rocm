# NLLB-ROCm Environment Configuration
# Copy this file to .env and adjust values as needed

# =============================================================================
# REQUIRED - Security
# =============================================================================

# Admin token for API authentication (CHANGE THIS!)
# Generate a secure token: python3 -c "import secrets; print(secrets.token_hex(32))"
ADMIN_TOKEN=your-secure-token-here

# =============================================================================
# PATHS
# =============================================================================

# Path to the CTranslate2 converted model
MODEL_PATH=/models/nllb-200-3.3B-ct2-int8

# Path to the tokens database
DB_PATH=/data/tokens.db

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================

# Maximum time (ms) to wait for batch to fill before processing
# Lower = less latency, Higher = better throughput
BATCH_TIMEOUT_MS=50

# Maximum requests per batch
# Higher values improve throughput but increase latency
MAX_BATCH_SIZE=8

# Default beam size: 1 for speed, 4 for balanced, 8 for best quality
# Can be overridden per-request with "quality" parameter
BEAM_SIZE=1

# Number of HIP/CUDA streams for parallel processing
INTER_THREADS=2

# Minimum wait time (ms) before checking queue again
MIN_BATCH_WAIT_MS=5

# Maximum queue size before rejecting requests (overload protection)
# Returns 503 when exceeded
MAX_QUEUE_SIZE=1000

# =============================================================================
# CACHE CONFIGURATION (Dragonfly/Redis)
# =============================================================================

# Enable/disable translation caching (true/false)
# When enabled, identical translations are served from cache (~5ms vs ~1s)
CACHE_ENABLED=true

# Cache TTL in seconds (how long to keep cached translations)
# Default: 3600 (1 hour). Set higher for static content, lower for dynamic.
CACHE_TTL_SECONDS=3600

# Redis/Dragonfly connection URL
# For docker-compose: redis://dragonfly:6379/0 (set automatically)
# For local development: redis://localhost:6379/0
REDIS_URL=redis://localhost:6379/0

# =============================================================================
# RATE LIMITING
# =============================================================================

# Enable/disable rate limiting per token (true/false)
# Protects against abuse and ensures fair usage
RATE_LIMIT_ENABLED=true

# Maximum requests per token within the window
RATE_LIMIT_REQUESTS=100

# Rate limit window in seconds
# Example: 100 requests per 60 seconds = ~1.67 req/sec sustained
RATE_LIMIT_WINDOW_SECONDS=60

# =============================================================================
# CIRCUIT BREAKER (GPU Failure Protection)
# =============================================================================

# Enable/disable circuit breaker for GPU failure protection (true/false)
# Prevents cascading failures when GPU encounters errors
CIRCUIT_BREAKER_ENABLED=true

# Number of consecutive failures before opening circuit
# When open, all requests return 503 immediately
CIRCUIT_BREAKER_THRESHOLD=5

# Seconds to wait before attempting to close circuit (half-open state)
# After timeout, one test request is allowed through
CIRCUIT_BREAKER_TIMEOUT=30

# =============================================================================
# ROCm / AMD GPU Settings
# =============================================================================

# Override GFX version for compatibility
# RX 6600/6600XT (gfx1032): use 10.3.0
# RX 6700 XT (gfx1031): use 10.3.0
# RX 6800/6900 (gfx1030): native support, may not need override
HSA_OVERRIDE_GFX_VERSION=10.3.0

# Which GPU to use (0 = first GPU)
ROCR_VISIBLE_DEVICES=0

# =============================================================================
# CLI Mode (optional, for direct script execution)
# =============================================================================

# Default source language (NLLB format)
SOURCE_LANG=eng_Latn

# Default target language (NLLB format)
TARGET_LANG=ukr_Cyrl

# =============================================================================
# Benchmark Script (optional)
# =============================================================================

# API URL for benchmark tests
API_URL=http://localhost:5000

# =============================================================================
# OPTIONAL DEPENDENCIES
# =============================================================================
# These Python packages enable additional features when installed:
#
# pip install uvloop      # Faster async event loop (~10-20% speedup)
# pip install orjson      # Faster JSON serialization
# pip install structlog   # Structured JSON logging
# pip install prometheus-client  # Prometheus metrics at /metrics
# pip install redis       # Redis/Dragonfly cache support
# pip install pysbd       # Better sentence segmentation
#
# Install all: pip install uvloop orjson structlog prometheus-client redis pysbd
